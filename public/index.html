<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Viagens</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="logo">
                    <i class="fas fa-route"></i>
                    <h1>Controle de Viagens</h1>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <input type="text" id="username" placeholder="Usuário" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="password" placeholder="Senha" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </form>
                <div class="guest-login">
                    <button id="guestLoginBtn" class="btn btn-secondary">Entrar como Convidado</button>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboardScreen" class="screen">
            <header class="header">
                <div class="header-content">
                    <h1><i class="fas fa-route"></i> Controle de Viagens</h1>
                    <div class="user-info">
                        <span id="currentUser"></span>
                        <button id="logoutBtn" class="btn btn-outline"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                </div>
            </header>

            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="trips">Viagens</button>
                <button class="nav-tab" data-tab="expenses">Despesas</button>
                <button class="nav-tab" data-tab="reports">Relatórios</button>
                <button class="nav-tab" data-tab="charts">Gráficos</button>
                <button class="nav-tab admin-only" data-tab="users">Usuários</button>
            </nav>

            <!-- Trips Tab -->
            <div id="tripsTab" class="tab-content active">
                <div class="tab-header">
                    <div class="header-with-filters">
                        <h2>Minhas Viagens</h2>
                        <div class="header-filters">
                            <input type="text" id="tripLocationFilter" placeholder="Filtrar por local..." class="filter-input">
                            <select id="tripStatusFilter" class="filter-input">
                                <option value="">Todos os status</option>
                                <option value="active">Em Andamento</option>
                                <option value="planned">Planejada</option>
                                <option value="completed">Concluída</option>
                            </select>
                            <input type="date" id="tripDateFilter" class="filter-input">
                        </div>
                    </div>
                    <button id="newTripBtn" class="btn btn-primary admin-only">
                        <i class="fas fa-plus"></i> Nova Viagem
                    </button>
                </div>
                <div id="tripsList" class="trips-list"></div>
            </div>

            <!-- Expenses Tab -->
            <div id="expensesTab" class="tab-content">
                <div class="tab-header">
                    <div class="header-with-total">
                        <h2>Despesas</h2>
                        <span id="totalExpensesDisplay" class="total-badge">Total: R$ 0,00</span>
                    </div>
                    <button id="newExpenseBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Nova Despesa
                    </button>
                </div>
                <div class="filters">
                    <select id="tripFilter">
                        <option value="">Todas as viagens</option>
                    </select>
                    <select id="categoryFilter">
                        <option value="">Todas as categorias</option>
                    </select>
                </div>
                <div id="expensesList" class="expenses-list"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content">
                <div class="tab-header">
                    <h2>Relatórios</h2>
                </div>
                <div class="reports-container">
                    <div class="report-card">
                        <h3>Resumo Financeiro</h3>
                        <div id="financialSummary"></div>
                    </div>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="chartsTab" class="tab-content">
                <div class="tab-header">
                    <h2>Gráficos</h2>
                </div>
                <div class="charts-filters">
                    <div class="form-group">
                        <label>Filtrar por Viagem:</label>
                        <select id="chartTripFilter">
                            <option value="">Todas as viagens</option>
                        </select>
                    </div>
                </div>
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Gastos por Categoria</h3>
                        <div class="chart-wrapper">
                            <canvas id="categoryChart"></canvas>
                        </div>
                        <div id="categoryLegend" class="chart-legend"></div>
                    </div>
                    <div class="chart-card">
                        <h3>Gastos por Tipo de Pagamento</h3>
                        <div class="chart-wrapper">
                            <canvas id="paymentChart"></canvas>
                        </div>
                        <div id="paymentLegend" class="chart-legend"></div>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="usersTab" class="tab-content">
                <div class="tab-header">
                    <h2>Gerenciamento de Usuários</h2>
                    <button id="newUserBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Novo Usuário
                    </button>
                </div>
                <div id="usersList" class="users-list-container"></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">Novo Usuário</h3>
                <span class="close">&times;</span>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="userName" required>
                </div>
                <div class="form-group">
                    <label>Usuário (Login)</label>
                    <input type="text" id="userUsername" required>
                </div>
                <div class="form-group" id="passwordGroup">
                    <label>Senha</label>
                    <input type="password" id="userPassword">
                    <small class="hint">Deixe em branco para manter a senha atual ao editar</small>
                </div>
                <div class="form-group">
                    <label>Perfil</label>
                    <select id="userRole" required>
                        <option value="user">Usuário Comum</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('userModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Resetar Senha</h3>
                <span class="close">&times;</span>
            </div>
            <form id="resetPasswordForm">
                <input type="hidden" id="resetUserId">
                <div class="form-group">
                    <p>Nova senha para <strong id="resetUserName"></strong>:</p>
                    <input type="password" id="newPassword" required placeholder="Nova senha">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('resetPasswordModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="tripModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nova Viagem</h3>
                <span class="close">&times;</span>
            </div>
            <form id="tripForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Destino Principal</label>
                        <input type="text" id="mainDestination" required>
                    </div>
                    <div class="form-group">
                        <label>Motivo Principal</label>
                        <input type="text" id="mainReason" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Outros Destinos</label>
                    <textarea id="otherDestinations" placeholder="Destinos secundários (opcional)"></textarea>
                </div>
                <div class="form-group">
                    <label>Acompanhantes</label>
                    <textarea id="companions" placeholder="Lista de acompanhantes"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Distância Aproximada (km)</label>
                        <input type="number" id="distance" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Consumo do Veículo (km/l)</label>
                        <input type="number" id="fuelConsumption" step="0.1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Data de Início</label>
                        <input type="date" id="startDate" required>
                    </div>
                    <div class="form-group">
                        <label>Data de Fim</label>
                        <input type="date" id="endDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Saldo Inicial em Dinheiro (R$)</label>
                    <input type="number" id="initialCash" step="0.01" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('tripModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nova Despesa</h3>
                <span class="close">&times;</span>
            </div>
            <form id="expenseForm" enctype="multipart/form-data">
                <div class="form-row">
                    <div class="form-group">
                        <label>Viagem</label>
                        <select id="expenseTripId" required></select>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="expenseCategory" required></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Pagamento</label>
                        <select id="expensePaymentType" required></select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Descrição</label>
                    <input type="text" id="expenseDescription" required>
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="expenseDate" required>
                </div>
                <div class="form-group">
                    <label>Recibo/Nota Fiscal</label>
                    <input type="file" id="expenseReceipt" accept="image/*">
                    <div id="receiptPreview"></div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('expenseModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="tripExpensesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Despesas da Viagem</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div id="tripExpensesList" class="expenses-list"></div>
            </div>
            <div class="modal-actions" style="padding: 20px; border-top: 1px solid #e9ecef;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('tripExpensesModal')">Fechar</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=2.2"></script>
</body>
</html>